<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Family Feud Teacher Control</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f2f2f2;
      padding: 20px;
    }
    .question-container {
      margin-bottom: 20px;
      display: none; /* hidden until game starts */
    }
    .answers-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
    }
    .answer-button {
      padding: 15px;
      background: #fff;
      border: 2px solid #333;
      border-radius: 10px;
      text-align: center;
      cursor: pointer;
      transition: background-color 0.3s ease, transform 0.3s ease;
    }
    .answer-button:hover {
      transform: scale(1.05);
    }
    /* When an answer is flipped, it turns green */
    .answer-button.revealed {
      background: #a6e22e;
    }
    /* A simple click animation */
    .answer-button.animate {
      animation: clickAnimation 0.5s ease;
    }
    @keyframes clickAnimation {
      from { transform: scale(0.9); }
      to { transform: scale(1); }
    }
    .controls {
      margin-top: 20px;
    }
    button {
      padding: 10px 15px;
      margin-right: 10px;
      font-size: 16px;
    }
    /* Styles for the questions text area */
    #questionsInput {
      width: 100%;
      height: 250px;
      margin-top: 20px;
      padding: 10px;
      font-size: 14px;
      border: 1px solid #ccc;
      border-radius: 5px;
      box-sizing: border-box;
    }
  </style>
</head>
<body>
  <h1>Family Feud Teacher Control</h1>
  <div class="controls">
    <button onclick="startGame()">Start Game</button>
    <button onclick="prevQuestion()">Previous Question</button>
    <button onclick="nextQuestion()">Next Question</button>
    <button onclick="resetQuestion()">Reset Question</button>
    <button onclick="makeStudentFullScreen()">Full Screen Student</button>
  </div>

  <!-- Container for the game (question text and answers grid) -->
  <div class="question-container" id="gameContainer">
    <h2 id="questionText"></h2>
    <div class="answers-grid" id="answersGrid">
      <!-- Answer buttons inserted here -->
    </div>
  </div>

  <!-- Text area for pasting questions, pre-populated with two sample questions -->
  <textarea id="questionsInput">
Name something you might eat for breakfast.
Eggs / 30
Pancakes / 20
Cereal / 15
Toast / 10
Bacon / 10
Fruit / 5
Oatmeal / 5
Coffee / 5

Name a popular vacation destination.
Beach / 25
Mountains / 20
City / 20
Resort / 15
Theme Park / 10
Cruise / 5
Countryside / 3
Skiing / 2
  </textarea>

  <script>
    let boardWindow;
    let questions = []; // Array to store parsed questions
    let currentQuestionIndex = 0;

    window.onload = function() {
      // Open the student board window.
      boardWindow = window.open("board.html", "boardWindow", "width=800,height=600");
    };

    // Called when "Start Game" is pressed.
    function startGame() {
      const text = document.getElementById("questionsInput").value;
      questions = parseQuestions(text);
      if (questions.length === 0) {
        alert("No valid questions were found. Please check your format.");
        return;
      }
      currentQuestionIndex = 0;
      document.getElementById("gameContainer").style.display = "block";
      loadQuestion();
    }

    // Parses the pasted text into an array of question objects.
    // It first checks for blank lines to separate blocks.
    // Each block must have a question (first line) and exactly 8 answer lines.
    function parseQuestions(text) {
      let qArray = [];
      if(text.indexOf("\n\n") !== -1) {
        // Use blank-line separation.
        const blocks = text.split(/\n\s*\n/).map(block => block.trim()).filter(block => block !== "");
        blocks.forEach((block, blockIndex) => {
          const lines = block.split("\n").map(line => line.trim()).filter(line => line !== "");
          if (lines.length < 9) {
            alert("Error in question block " + (blockIndex+1) + ": Incomplete question. Need 1 question and 8 answers.");
            return; // skip this block
          }
          const questionText = lines[0];
          let answers = [];
          let validBlock = true;
          for (let i = 1; i <= 8; i++) {
            const parts = lines[i].split("/");
            if (parts.length < 2) {
              alert("Error in question block " + (blockIndex+1) + ": Answer line " + i + " is not in 'Answer / point' format.");
              validBlock = false;
              break;
            }
            const answerText = parts[0].trim();
            const points = parseInt(parts[1].trim(), 10);
            if (isNaN(points)) {
              alert("Error in question block " + (blockIndex+1) + ": Invalid point value for answer '" + answerText + "'.");
              validBlock = false;
              break;
            }
            answers.push({ text: answerText, points: points, revealed: false });
          }
          if (validBlock) {
            qArray.push({ question: questionText, answers: answers });
          }
        });
      } else {
        // Assume sequential blocks of 9 lines.
        const lines = text.split("\n").map(line => line.trim()).filter(line => line !== "");
        if (lines.length % 9 !== 0) {
          alert("The input text does not contain a multiple of 9 non-empty lines. Please check your format.");
          return [];
        }
        for (let i = 0; i < lines.length; i += 9) {
          const questionText = lines[i];
          let answers = [];
          let validBlock = true;
          for (let j = 1; j < 9; j++) {
            const parts = lines[i + j].split("/");
            if (parts.length < 2) {
              alert("Error in question block starting at line " + (i+1) + ": Answer line " + j + " is not in 'Answer / point' format.");
              validBlock = false;
              break;
            }
            const answerText = parts[0].trim();
            const points = parseInt(parts[1].trim(), 10);
            if (isNaN(points)) {
              alert("Error in question block starting at line " + (i+1) + ": Invalid point value for answer '" + answerText + "'.");
              validBlock = false;
              break;
            }
            answers.push({ text: answerText, points: points, revealed: false });
          }
          if (validBlock) {
            qArray.push({ question: questionText, answers: answers });
          }
        }
      }
      return qArray;
    }

    // loadQuestion() sorts the answers (by descending points), then arranges them in a 2‑column, 4‑row grid.
    function loadQuestion() {
      const questionData = questions[currentQuestionIndex];
      // Sort answers descending by points.
      const sortedAnswers = questionData.answers.slice().sort((a, b) => b.points - a.points);
      // For two columns, four rows, split sorted answers into two groups and interleave.
      const leftColumn = sortedAnswers.slice(0, 4);
      const rightColumn = sortedAnswers.slice(4, 8);
      const displayAnswers = [];
      for (let i = 0; i < 4; i++) {
        displayAnswers.push(leftColumn[i]);
        displayAnswers.push(rightColumn[i]);
      }
      questionData.displayAnswers = displayAnswers;

      document.getElementById("questionText").textContent = questionData.question;
      const grid = document.getElementById("answersGrid");
      grid.innerHTML = "";
      displayAnswers.forEach((ans, index) => {
        const btn = document.createElement("div");
        btn.className = "answer-button";
        btn.id = "answerBtn" + index;
        btn.innerHTML = `<strong>${ans.text}</strong><br>${ans.points}`;
        if (ans.revealed) {
          btn.classList.add("revealed");
        }
        btn.onclick = function() {
          if (!ans.revealed) {
            revealAnswer(index);
          }
        };
        grid.appendChild(btn);
      });
      sendUpdateToBoard();
    }

    function revealAnswer(index) {
      const questionData = questions[currentQuestionIndex];
      questionData.displayAnswers[index].revealed = true;
      
      const btn = document.getElementById("answerBtn" + index);
      btn.classList.add("animate");
      setTimeout(() => {
        btn.classList.remove("animate");
      }, 500);
      btn.classList.add("revealed");
      
      boardWindow.postMessage({ 
        type: "reveal", 
        questionIndex: currentQuestionIndex, 
        revealedIndex: index,
        questionData: questionData 
      }, "*");
    }

    function resetQuestion() {
      const questionData = questions[currentQuestionIndex];
      questionData.answers.forEach(ans => ans.revealed = false);
      loadQuestion();
    }

    function nextQuestion() {
      if (currentQuestionIndex < questions.length - 1) {
        currentQuestionIndex++;
        loadQuestion();
      } else {
        alert("This is the last question.");
      }
    }

    function prevQuestion() {
      if (currentQuestionIndex > 0) {
        currentQuestionIndex--;
        loadQuestion();
      } else {
        alert("This is the first question.");
      }
    }

    function sendUpdateToBoard() {
      const questionData = questions[currentQuestionIndex];
      boardWindow.postMessage({ 
        type: "update", 
        questionIndex: currentQuestionIndex, 
        questionData: questionData 
      }, "*");
    }

    function makeStudentFullScreen() {
      boardWindow.postMessage({ type: "fullscreen" }, "*");
    }
  </script>
</body>
</html>
